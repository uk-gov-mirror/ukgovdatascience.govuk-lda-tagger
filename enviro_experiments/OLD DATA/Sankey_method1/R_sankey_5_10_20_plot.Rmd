---
title: "sankey plot for 5 to 10 to 20 topics (phrasemachine)"
output: html_notebook
---
sort out directory for relative filepaths
```{r}
getwd()
#install.packages("rCharts")
library(networkD3)
library(devtools)
#install_github('rCharts', 'ramnathv')
library(rCharts)
#install.packages('magrittr')
library(magrittr)
#install.packages('dplyr')
library(dplyr)

```
read in data which was prepared in python and sort out structure so that it can be understood by NetworkD3
```{r}
setwd("..")
df_5_10 <- as.data.frame(read.csv("./sankey_data_5_10_PM.csv", header = TRUE))
df_10_20 <- as.data.frame(read.csv("./sankey_data_10_20_PM.csv", header = TRUE))

df_10_20$source = df_10_20$source + 5

df_5_10$source2 = paste0("5_", (df_5_10$source + 1))
df_10_20$source2 = paste0("10_", (df_10_20$source + 1))

df_5_10$target2 = paste0("10_", (df_5_10$target + 1))
df_10_20$target2 = paste0("20_", (df_10_20$target + 1))

df_5_10$target = df_5_10$target + 5
df_10_20$target = df_10_20$target + 15

links <- rbind(df_5_10, df_10_20)
sequence <- data.frame(node = seq(0, 34, by = 1))
sequence$node_id <- c(paste0("topic", seq(1, 5, by = 1), "/5"), paste0("topic", seq(1, 10, by = 1), "/10"), paste0("topic", seq(1, 20, by = 1), "/20"))



```
node <- data.frame(node = c(paste0("5_", seq(1, 5, by = 1)), paste0("10_", seq(1, 10, by = 1)), paste0("20_", seq(1, 20, by = 1))))
name <- data.frame(name = c(paste0("topic", seq(1, 5, by = 1), "/5"), paste0("topic", seq(1, 10, by = 1), "/10"), paste0("topic", seq(1, 20, by = 1), "/20")))

nodes <- data.frame(node, name)

now try plot:

```{r}
sankeyNetwork(Links = links, Nodes = sequence, Source = "source",
             Target = "target", Value = "value", fontSize = 12, NodeID = "node_id", nodeWidth = 30) %>% 

saveNetwork(file = 'SankeyPlot_5_10_20topics.html')
```

Everything below is redundant but code here in case it's useful for future sankey plots

```{r}

# The function used to create the plots
sanktify <- function(x) {

  # Create nodes DF with the unique sources & targets from input

  #  ***** changing this is the key***********************************************************
  nodes <- data.frame(unique(c(x$source,x$target)),stringsAsFactors=FALSE)
  # ************************************************************************************************
  nodes$ID <- as.numeric(rownames(nodes)) - 1 # sankeyNetwork requires IDs to be zero-indexed
  names(nodes) <- c("name", "ID")

  # use dplyr join over merge since much better; in this case not big enough to matter
  # Replace source & target in links DF with IDs
  links <- inner_join(x, nodes, by = c("source"="name")) %>%
    rename(source_ID = ID) %>%
    inner_join(nodes, by = c("target"="name")) %>%
    rename(target_ID = ID) 

  # Create Sankey Plot
  sank <- sankeyNetwork(
    Links = links,
    Nodes = nodes,
    Source = "source",
    Target = "target",
    Value = "value",
    NodeID = "name",
    fontSize = 12,
    nodeWidth = 30
  )

  return(sank)

}

sanktify(links)
```





sequence <- data.frame(seq(0, 29, by = 1))
sequence$node_id <- paste0("topic_", sequence$seq.0..29..by...1.)
names(sequence)
```

```{r}
URL <- paste0("https://cdn.rawgit.com/christophergandrud/networkD3/",
              "master/JSONdata/energy.json")
Energy <- jsonlite::fromJSON(URL)
nodes_eg <- (Energy$nodes)
links_eg <- (Energy$links)
```

Exploring plots of relationships between topics

```{r}

sankeyNetwork(Links = sankey_data, Nodes = sequence, Source = "source",
             Target = "target2", Value = "value", fontSize = 12, NodeID = "node_id", nodeWidth = 30) %>%
saveNetwork(file = 'SankeyPlot_10_20topics.html')
```

NOte that the topics in the 10 topic model are named 0-9 and in the 20 topic model are named 10-29
